"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"getFirebase",{enumerable:!0,get:function(){return _reactReduxFirebase.getFirebase}}),Object.defineProperty(exports,"firebaseReducer",{enumerable:!0,get:function(){return _reactReduxFirebase.firebaseReducer}}),Object.defineProperty(exports,"reactReduxFirebase",{enumerable:!0,get:function(){return _reactReduxFirebase.reactReduxFirebase}}),Object.defineProperty(exports,"reduxFirestore",{enumerable:!0,get:function(){return _reduxFirestore.reduxFirestore}}),Object.defineProperty(exports,"firestoreReducer",{enumerable:!0,get:function(){return _reduxFirestore.firestoreReducer}}),exports.reduxFirebase=exports.firestoreConnect=exports.firebaseConnect=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectSpread3=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread")),_typeof2=_interopRequireDefault(require("@babel/runtime/helpers/typeof")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_react=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_hoistNonReactStatics=_interopRequireDefault(require("hoist-non-react-statics")),_reactReduxFirebase=require("react-redux-firebase"),_query=require("react-redux-firebase/lib/actions/query"),_utils=require("react-redux-firebase/lib/utils"),_reduxFirestore=require("redux-firestore"),fb="firebase",_getEventsFromInput=function(a,b){var c=[];return a?(Object.keys(a).forEach(function(d){var e=a[d],f=e.path,g=e.listeners;g.forEach(function(a){var d;c.push((d={path:f},(0,_defineProperty2.default)(d,b===fb?"path":"collection",f),(0,_defineProperty2.default)(d,"queryParams",a),d))})}),(0,_utils.getEventsFromInput)(c)):c},getDisplayName=function(a){return a.displayName||a.name||("string"==typeof a?a:"Component")},_connect=function(a){return function(){var b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},c=1<arguments.length?arguments[1]:void 0;return function(d){var e={},f=function(c){function f(c,d){var g;(0,_classCallCheck2.default)(this,f);var h=d.store;g=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(f).call(this)),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)((0,_assertThisInitialized2.default)(g)),"firebaseEvents",[]),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)((0,_assertThisInitialized2.default)(g)),"firebase",null),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)((0,_assertThisInitialized2.default)(g)),"prevData",null),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)((0,_assertThisInitialized2.default)(g)),"watchEvents",function(b,c,d){a===fb?(0,_query.watchEvents)(b,c,d):b.setListeners(d)}),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)((0,_assertThisInitialized2.default)(g)),"unWatchEvents",function(b,c,d){a===fb?(0,_query.unWatchEvents)(b,c,d):b.unsetListeners(d)}),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)((0,_assertThisInitialized2.default)(g)),"getUpdatedEvents",function(b){var c=_getEventsFromInput(b,a),d=g.firebaseEvents,e=[],f=d;return c.forEach(function(a){var b=a.queryId,c=d.some(function(a){var c=a.queryId;return c===b});c?f=f.filter(function(a){var c=a.queryId;return c!==b}):e.push(a)}),{addedEvents:e,removedEvents:f}}),(0,_defineProperty2.default)((0,_assertThisInitialized2.default)((0,_assertThisInitialized2.default)(g)),"getStateProps",function(b){var c=g.context.store.getState,d=c(),f={},h=b||g.prevData;return Object.keys(h).forEach(function(b){var c=h[b],i=c.path,j=c.defaultValue,k=d[a]&&d[a].data&&[d[a].data].concat(i.split("/")).reduce(function(c,a){return c&&c[a]});e[b]=function(b){return b[a]&&b[a].data&&[b[a].data].concat(i.split("/")).reduce(function(c,a){return c&&c[a]})};var l="isLoaded".concat(b[0].toUpperCase()).concat(b.substr(1)),m=f[l]||(0,_reactReduxFirebase.isLoaded)(k),n=g.state&&g.state[i]&&g.state[i].value,o="object"===(0,_typeof2.default)(n)&&"object"===(0,_typeof2.default)(k);j&&!m&&(k="function"==typeof j?j(d):"string"==typeof j&&/\./.test(j)?[d].concat(j.split(".")).reduce(function(c,a){return c[a]}):j,m=!!k),f.propsToPaths=(0,_objectSpread3.default)({},f.propsToPaths,(0,_defineProperty2.default)({},b,i)),f[i]={isLoaded:m,value:o?(0,_objectSpread3.default)({},n,k):k}}),f});var i=(0,_utils.createCallable)(b),j=i(c,h);return g.prevData=j,g.context=d,g.state=g.getStateProps(j),g}return(0,_inherits2.default)(f,c),(0,_createClass2.default)(f,[{key:"componentWillMount",value:function(){var b=this.context.store;if(b[a]){var c=b[a],d=c.ref,e=c.helpers,f=c.storage,g=c.database,h=c.auth;this.firebase=(0,_objectSpread3.default)({ref:d,storage:f,database:g,auth:h},e),this.firebaseEvents=_getEventsFromInput(this.prevData,a)}}},{key:"componentDidMount",value:function(){var b=this.context.store;b[a]&&this.watchEvents(b[a],b.dispatch,this.firebaseEvents)}},{key:"componentWillUnmount",value:function(){var b=this.context.store;this.unWatchEvents(b[a],b.dispatch,this.firebaseEvents)}},{key:"componentWillReceiveProps",value:function(c){var d=this.context.store,e=(0,_utils.createCallable)(b),f=e(c,d),g=this.getUpdatedEvents(f),h=g.addedEvents,i=g.removedEvents,j=this.getStateProps(f);(h.length||i.length)&&(this.prevData=f,this.unWatchEvents(d[a],d.dispatch,this.firebaseEvents),this.firebaseEvents=_getEventsFromInput(f,a),this.watchEvents(d[a],d.dispatch,this.firebaseEvents)),this.setState(j)}},{key:"render",value:function(){var a=this,b=this.state.propsToPaths,c={};return Object.keys(b).forEach(function(d){var e=a.state,f=b[d],g=a.prevData[d]&&a.prevData[d].modifyResult,h="isLoaded".concat(d[0].toUpperCase()).concat(d.substr(1));c[h]=e[f].isLoaded,c[d]="function"==typeof g?g(e[f].value):e[f].value}),_react.default.createElement(d,(0,_extends2.default)({},this.props,c))}}]),f}(_react.PureComponent);(0,_defineProperty2.default)(f,"contextTypes",{store:_propTypes.default.object.isRequired}),(0,_defineProperty2.default)(f,"displayName","F".concat(a.slice(1),"Connect(").concat(getDisplayName(d),")")),(0,_defineProperty2.default)(f,"wrappedComponent",d);var g=(0,_hoistNonReactStatics.default)(f,d);return c?c(e)(g):g}}},firebaseConnect=_connect(fb);exports.firebaseConnect=firebaseConnect;var firestoreConnect=_connect("firestore");exports.firestoreConnect=firestoreConnect;var reduxFirebase=_reactReduxFirebase.reactReduxFirebase;exports.reduxFirebase=reduxFirebase;